textAngularSetup=angular.module("textAngularSetup",[]);textAngularSetup.value("taOptions",{toolbar:[["h1","h2","h3","h4","h5","h6","highlight","p","pre","quote"],["bold","italics","underline","ul","ol","redo","undo","clear"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"],["html","insertImage","insertLink","insertVideo"]],classes:{focussed:"focussed",toolbar:"btn-toolbar",toolbarGroup:"btn-group",toolbarButton:"btn btn-default",toolbarButtonActive:"active",disabled:"disabled",textEditor:"form-control",htmlEditor:"form-control"},setup:{textEditorSetup:function($element){},htmlEditorSetup:function($element){}},defaultFileDropHandler:function(file,insertAction){var reader=new FileReader;if(file.type.substring(0,5)==="image"){reader.onload=function(){if(reader.result!=="")insertAction("insertImage",reader.result,true)};reader.readAsDataURL(file);return true}return false}});textAngularSetup.value("taSelectableElements",["a","img"]);textAngularSetup.value("taCustomRenderers",[{selector:"img",customAttribute:"ta-insert-video",renderLogic:function(element){var iframe=angular.element("<iframe></iframe>");var attributes=element.prop("attributes");angular.forEach(attributes,function(attr){iframe.attr(attr.name,attr.value)});iframe.attr("src",iframe.attr("ta-insert-video"));element.replaceWith(iframe)}}]);textAngularSetup.constant("taTranslations",{toggleHTML:"Toggle HTML",insertImage:"Please enter a image URL to insert",insertLink:"Please enter a URL to insert",insertVideo:"Please enter a youtube URL to embed"});textAngularSetup.run(["taRegisterTool","$window","taTranslations","taSelection",function(taRegisterTool,$window,taTranslations,taSelection){taRegisterTool("html",{buttontext:taTranslations.toggleHTML,action:function(){this.$editor().switchView()},activeState:function(){return this.$editor().showHtml}});var _retActiveStateFunction=function(q){return function(){return this.$editor().queryFormatBlockState(q)}};var headerAction=function(){return this.$editor().wrapSelection("formatBlock","<"+this.name.toUpperCase()+">")};angular.forEach(["h1","h2","h3","h4","h5","h6"],function(h){taRegisterTool(h.toLowerCase(),{buttontext:h.toUpperCase(),action:headerAction,activeState:_retActiveStateFunction(h.toLowerCase())})});taRegisterTool("highlight",{isHighlighted:false,iconclass:"fa fa-pencil",action:function(){taSelection.wrapSelectionWithTag("<mark>",this.isHighlighted);this.$editor().taScope.html=this.$editor().displayElements.text[0].innerHTML;return this.$editor.taModel},activeState:function(){var editor=this.$editor&&this.$editor().displayElements?this.$editor().displayElements.text[0]:this.$editor().editorDisplayElements.text;this.isHighlighted=taSelection.isSelectionUnderTag("mark",editor);return this.isHighlighted}});taRegisterTool("p",{buttontext:"P",action:function(){return this.$editor().wrapSelection("formatBlock","<P>")},activeState:function(){return this.$editor().queryFormatBlockState("p")}});taRegisterTool("pre",{buttontext:"pre",action:function(){return this.$editor().wrapSelection("formatBlock","<PRE>")},activeState:function(){return this.$editor().queryFormatBlockState("pre")}});taRegisterTool("ul",{iconclass:"fa fa-list-ul",action:function(){return this.$editor().wrapSelection("insertUnorderedList",null)},activeState:function(){return document.queryCommandState("insertUnorderedList")}});taRegisterTool("ol",{iconclass:"fa fa-list-ol",action:function(){return this.$editor().wrapSelection("insertOrderedList",null)},activeState:function(){return document.queryCommandState("insertOrderedList")}});taRegisterTool("quote",{iconclass:"fa fa-quote-right",action:function(){return this.$editor().wrapSelection("formatBlock","<BLOCKQUOTE>")},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}});taRegisterTool("undo",{iconclass:"fa fa-undo",action:function(){return this.$editor().wrapSelection("undo",null)}});taRegisterTool("redo",{iconclass:"fa fa-repeat",action:function(){return this.$editor().wrapSelection("redo",null)}});taRegisterTool("bold",{iconclass:"fa fa-bold",action:function(){return this.$editor().wrapSelection("bold",null)},activeState:function(){return document.queryCommandState("bold")},commandKeyCode:98});taRegisterTool("justifyLeft",{iconclass:"fa fa-align-left",action:function(){return this.$editor().wrapSelection("justifyLeft",null)},activeState:function(commonElement){var result=false;if(commonElement)result=commonElement.css("text-align")==="left"||commonElement.attr("align")==="left"||commonElement.css("text-align")!=="right"&&commonElement.css("text-align")!=="center"&&!document.queryCommandState("justifyRight")&&!document.queryCommandState("justifyCenter");result=result||document.queryCommandState("justifyLeft");return result}});taRegisterTool("justifyRight",{iconclass:"fa fa-align-right",action:function(){return this.$editor().wrapSelection("justifyRight",null)},activeState:function(commonElement){var result=false;if(commonElement)result=commonElement.css("text-align")==="right";result=result||document.queryCommandState("justifyRight");return result}});taRegisterTool("justifyCenter",{iconclass:"fa fa-align-center",action:function(){return this.$editor().wrapSelection("justifyCenter",null)},activeState:function(commonElement){var result=false;if(commonElement)result=commonElement.css("text-align")==="center";result=result||document.queryCommandState("justifyCenter");return result}});taRegisterTool("indent",{iconclass:"fa fa-indent",tooltiptext:"Indent",action:function(){return this.$editor().wrapSelection("indent",null)},activeState:function(){return this.$editor().queryFormatBlockState("blockquote")}});taRegisterTool("outdent",{iconclass:"fa fa-outdent",tooltiptext:"Outdent",action:function(){return this.$editor().wrapSelection("outdent",null)},activeState:function(){return false}});taRegisterTool("italics",{iconclass:"fa fa-italic",action:function(){return this.$editor().wrapSelection("italic",null)},activeState:function(){return document.queryCommandState("italic")},commandKeyCode:105});taRegisterTool("underline",{iconclass:"fa fa-underline",action:function(){return this.$editor().wrapSelection("underline",null)},activeState:function(){return document.queryCommandState("underline")},commandKeyCode:117});taRegisterTool("clear",{iconclass:"fa fa-ban",action:function(deferred,restoreSelection){if(this.$editor.wrapSelection){this.$editor().wrapSelection("removeFormat",null)}var possibleNodes=angular.element(taSelection.getSelectionElement());var removeListElements=function(list){list=angular.element(list);var prevElement=list;angular.forEach(list.children(),function(liElem){var newElem=angular.element("<p></p>");newElem.html(angular.element(liElem).html());prevElement.after(newElem);prevElement=newElem});list.remove()};taSelection.clearAllHighlightsFromNode(this.$editor().displayElements.text[0]);angular.forEach(possibleNodes.find("ul"),removeListElements);angular.forEach(possibleNodes.find("ol"),removeListElements);var $editor=this.$editor();var recursiveRemoveClass=function(node){node=angular.element(node);if(node[0]!==$editor.displayElements.text[0])node.removeAttr("class");angular.forEach(node.children(),recursiveRemoveClass)};angular.forEach(possibleNodes,recursiveRemoveClass);if(possibleNodes[0].tagName.toLowerCase()!=="li"&&possibleNodes[0].tagName.toLowerCase()!=="ol"&&possibleNodes[0].tagName.toLowerCase()!=="ul")this.$editor().wrapSelection("formatBlock","<p>");restoreSelection()}});var imgOnSelectAction=function(event,$element,editorScope){var finishEdit=function(){editorScope.updateTaBindtaTextElement();editorScope.hidePopover()};event.preventDefault();editorScope.displayElements.popover.css("width","375px");var container=editorScope.displayElements.popoverContainer;container.empty();var buttonGroup=angular.element('<div class="btn-group" style="padding-right: 6px;">');var fullButton=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">100% </button>');fullButton.on("click",function(event){event.preventDefault();$element.css({width:"100%",height:""});finishEdit()});var halfButton=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">50% </button>');halfButton.on("click",function(event){event.preventDefault();$element.css({width:"50%",height:""});finishEdit()});var quartButton=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">25% </button>');quartButton.on("click",function(event){event.preventDefault();$element.css({width:"25%",height:""});finishEdit()});var resetButton=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1">Reset</button>');resetButton.on("click",function(event){event.preventDefault();$element.css({width:"",height:""});finishEdit()});buttonGroup.append(fullButton);buttonGroup.append(halfButton);buttonGroup.append(quartButton);buttonGroup.append(resetButton);container.append(buttonGroup);buttonGroup=angular.element('<div class="btn-group" style="padding-right: 6px;">');var floatLeft=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-left"></i></button>');floatLeft.on("click",function(event){event.preventDefault();$element.css("float","left");finishEdit()});var floatRight=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-right"></i></button>');floatRight.on("click",function(event){event.preventDefault();$element.css("float","right");finishEdit()});var floatNone=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-align-justify"></i></button>');floatNone.on("click",function(event){event.preventDefault();$element.css("float","");finishEdit()});buttonGroup.append(floatLeft);buttonGroup.append(floatNone);buttonGroup.append(floatRight);container.append(buttonGroup);buttonGroup=angular.element('<div class="btn-group">');var remove=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" unselectable="on" tabindex="-1"><i class="fa fa-trash-o"></i></button>');remove.on("click",function(event){event.preventDefault();$element.remove();finishEdit()});buttonGroup.append(remove);container.append(buttonGroup);editorScope.showPopover($element);editorScope.showResizeOverlay($element)};taRegisterTool("insertImage",{iconclass:"fa fa-picture-o",action:function(){var imageLink;imageLink=$window.prompt(taTranslations.insertImage,"http://");if(imageLink&&imageLink!==""&&imageLink!=="http://"){return this.$editor().wrapSelection("insertImage",imageLink,true)}},onElementSelect:{element:"img",action:imgOnSelectAction}});taRegisterTool("insertVideo",{iconclass:"fa fa-youtube-play",action:function(){var urlPrompt;urlPrompt=$window.prompt(taTranslations.insertVideo,"http://");if(urlPrompt&&urlPrompt!==""&&urlPrompt!=="http://"){var ids=urlPrompt.match(/(\?|&)v=[^&]*/);if(ids.length>0){var urlLink="http://www.youtube.com/embed/"+ids[0].substring(3);var embed='<img class="ta-insert-video" ta-insert-video="'+urlLink+'" contenteditable="false" src="" allowfullscreen="true" width="300" frameborder="0" height="250"/>';return this.$editor().wrapSelection("insertHTML",embed,true)}}},onElementSelect:{element:"img",onlyWithAttrs:["ta-insert-video"],action:imgOnSelectAction}});taRegisterTool("insertLink",{iconclass:"fa fa-link",action:function(){var urlLink;urlLink=$window.prompt(taTranslations.insertLink,"http://");if(urlLink&&urlLink!==""&&urlLink!=="http://"){return this.$editor().wrapSelection("createLink",urlLink,true)}},activeState:function(commonElement){if(commonElement)return commonElement[0].tagName==="A";return false},onElementSelect:{element:"a",action:function(event,$element,editorScope){event.preventDefault();editorScope.displayElements.popover.css("width","305px");var container=editorScope.displayElements.popoverContainer;container.empty();container.css("line-height","28px");var link=angular.element('<a href="'+$element.attr("href")+'" target="_blank">'+$element.attr("href")+"</a>");link.css({display:"inline-block","max-width":"200px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap","vertical-align":"middle"});container.append(link);var buttonGroup=angular.element('<div class="btn-group pull-right">');var reLinkButton=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on"><i class="fa fa-edit icon-edit"></i></button>');reLinkButton.on("click",function(event){event.preventDefault();var urlLink=$window.prompt(taTranslations.insertLink,$element.attr("href"));if(urlLink&&urlLink!==""&&urlLink!=="http://"){$element.attr("href",urlLink);editorScope.updateTaBindtaTextElement()}editorScope.hidePopover()});buttonGroup.append(reLinkButton);var unLinkButton=angular.element('<button type="button" class="btn btn-default btn-sm btn-small" tabindex="-1" unselectable="on"><i class="fa fa-unlink icon-unlink"></i></button>');unLinkButton.on("click",function(event){event.preventDefault();$element.replaceWith($element.contents());editorScope.updateTaBindtaTextElement();editorScope.hidePopover()});buttonGroup.append(unLinkButton);container.append(buttonGroup);editorScope.showPopover($element)}}})}]);(function(){"Use Strict";var globalContentEditableBlur=false;if(/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)){document.addEventListener("click",function(){var curelement=window.event.target;if(globalContentEditableBlur&&curelement!==null){var isEditable=false;var tempEl=curelement;while(tempEl!==null&&tempEl.tagName.toLowerCase()!=="html"&&!isEditable){isEditable=tempEl.contentEditable==="true";tempEl=tempEl.parentNode}if(!isEditable){document.getElementById("textAngular-editableFix-010203040506070809").setSelectionRange(0,0);curelement.focus()}}globalContentEditableBlur=false},false);angular.element(document.body).append('<input id="textAngular-editableFix-010203040506070809" style="width:1px;height:1px;border:none;margin:0;padding:0;position:absolute; top: -10000; left: -10000;" unselectable="on" tabIndex="-1">')}var ie=function(){var undef,rv=-1;var ua=window.navigator.userAgent;var msie=ua.indexOf("MSIE ");var trident=ua.indexOf("Trident/");if(msie>0){rv=parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10)}else if(trident>0){var rvNum=ua.indexOf("rv:");rv=parseInt(ua.substring(rvNum+3,ua.indexOf(".",rvNum)),10)}return rv>-1?rv:undef}();if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}function validElementString(string){try{return angular.element(string).length!==0}catch(any){return false}}var sheet,addCSSRule,removeCSSRule;if(ie>8||ie===undefined){var topsheet=function(){var style=document.createElement("style");if(/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent))style.appendChild(document.createTextNode(""));document.head.insertBefore(style,document.head.firstChild);return style.sheet}();sheet=function(){var style=document.createElement("style");if(/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent))style.appendChild(document.createTextNode(""));document.head.appendChild(style);return style.sheet}();addCSSRule=function(selector,rules){_addCSSRule(sheet,selector,rules)};_addCSSRule=function(sheet,selector,rules){var insertIndex;if(sheet.rules)insertIndex=Math.max(sheet.rules.length-1,0);else if(sheet.cssRules)insertIndex=Math.max(sheet.cssRules.length-1,0);if(sheet.insertRule){sheet.insertRule(selector+"{"+rules+"}",insertIndex)}else{sheet.addRule(selector,rules,insertIndex)}return insertIndex};removeCSSRule=function(index){_removeCSSRule(sheet,index)};_removeCSSRule=function(sheet,index){if(sheet.removeRule){sheet.removeRule(index)}else{sheet.deleteRule(index)}};_addCSSRule(topsheet,".ta-scroll-window.form-control","height: 300px; overflow: auto; font-family: inherit; font-size: 100%; position: relative; padding: 0;");_addCSSRule(topsheet,".ta-root.focussed .ta-scroll-window.form-control","border-color: #66afe9; outline: 0; -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(102, 175, 233, 0.6);");_addCSSRule(topsheet,".ta-editor.ta-html","min-height: 300px; height: auto; overflow: auto; font-family: inherit; font-size: 100%;");_addCSSRule(topsheet,".ta-scroll-window .ta-bind","height: auto; min-height: 300px; padding: 6px 12px;");_addCSSRule(topsheet,".ta-root .ta-resizer-handle-overlay","z-index: 100; position: absolute; display: none;");_addCSSRule(topsheet,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-info","position: absolute; bottom: 16px; right: 16px; border: 1px solid black; background-color: #FFF; padding: 0 4px; opacity: 0.7;");_addCSSRule(topsheet,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-background","position: absolute; bottom: 5px; right: 5px; left: 5px; top: 5px; border: 1px solid black; background-color: rgba(0, 0, 0, 0.2);");_addCSSRule(topsheet,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner","width: 10px; height: 10px; position: absolute;");_addCSSRule(topsheet,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-tl","top: 0; left: 0; border-left: 1px solid black; border-top: 1px solid black;");_addCSSRule(topsheet,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-tr","top: 0; right: 0; border-right: 1px solid black; border-top: 1px solid black;");_addCSSRule(topsheet,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-bl","bottom: 0; left: 0; border-left: 1px solid black; border-bottom: 1px solid black;");_addCSSRule(topsheet,".ta-root .ta-resizer-handle-overlay > .ta-resizer-handle-corner-br","bottom: 0; right: 0; border: 1px solid black; cursor: se-resize; background-color: white;")}function getByAttribute(element,attribute){var resultingElements=[];var childNodes=element.children();if(childNodes.length){angular.forEach(childNodes,function(child){resultingElements=resultingElements.concat(getByAttribute(angular.element(child),attribute))})}if(element.attr(attribute)!==undefined)resultingElements.push(element);return resultingElements}var dropFired=false;var textAngular=angular.module("textAngular",["ngSanitize","textAngularSetup"]);var taTools={};function registerTextAngularTool(name,toolDefinition){if(!name||name===""||taTools.hasOwnProperty(name))throw"textAngular Error: A unique name is required for a Tool Definition";if(toolDefinition.display&&(toolDefinition.display===""||!validElementString(toolDefinition.display))||!toolDefinition.display&&!toolDefinition.buttontext&&!toolDefinition.iconclass)throw'textAngular Error: Tool Definition for "'+name+'" does not have a valid display/iconclass/buttontext value';taTools[name]=toolDefinition}textAngular.constant("taRegisterTool",registerTextAngularTool);textAngular.value("taTools",taTools);textAngular.config([function(){angular.forEach(taTools,function(value,key){delete taTools[key]})}]);textAngular.directive("textAngular",["$compile","$timeout","taOptions","taSanitize","taSelection","taExecCommand","textAngularManager","$window","$document","$animate","$log",function($compile,$timeout,taOptions,taSanitize,taSelection,taExecCommand,textAngularManager,$window,$document,$animate,$log){return{require:"?ngModel",scope:{taDisabled:"=",taDisableTyping:"="},restrict:"EA",controller:function($scope){return{getDisplayElements:function(){return $scope.displayElements},getTaScope:function(){return $scope}}},link:function(scope,element,attrs,ngModel){var _keydown,_keyup,_keypress,_mouseup,_focusin,_focusout,_originalContents,_toolbars,_serial=attrs.serial?attrs.serial:Math.floor(Math.random()*1e16),_name=attrs.name?attrs.name:"textAngularEditor"+_serial,_taExecCommand;var oneEvent=function(_element,event,action){$timeout(function(){var _func=function(){_element.off(event,_func);action()};_element.on(event,_func)},100)};_taExecCommand=taExecCommand(attrs.taDefaultWrap);angular.extend(scope,angular.copy(taOptions),{wrapSelection:function(command,opt,isSelectableElementTool){_taExecCommand(command,false,opt);if(isSelectableElementTool){scope["reApplyOnSelectorHandlerstaTextElement"+_serial]()}scope.displayElements.text[0].focus()},showHtml:false});if(attrs.taFocussedClass)scope.classes.focussed=attrs.taFocussedClass;if(attrs.taTextEditorClass)scope.classes.textEditor=attrs.taTextEditorClass;if(attrs.taHtmlEditorClass)scope.classes.htmlEditor=attrs.taHtmlEditorClass;if(attrs.taTextEditorSetup)scope.setup.textEditorSetup=scope.$parent.$eval(attrs.taTextEditorSetup);if(attrs.taHtmlEditorSetup)scope.setup.htmlEditorSetup=scope.$parent.$eval(attrs.taHtmlEditorSetup);if(attrs.taFileDrop)scope.fileDropHandler=scope.$parent.$eval(attrs.taFileDrop);else scope.fileDropHandler=scope.defaultFileDropHandler;_originalContents=element[0].innerHTML;element[0].innerHTML="";scope.displayElements={forminput:angular.element("<input type='hidden' tabindex='-1' style='display: none;'>"),html:angular.element("<textarea></textarea>"),text:angular.element("<div></div>"),scrollWindow:angular.element("<div class='ta-scroll-window'></div>"),popover:angular.element('<div class="popover fade bottom" style="max-width: none; width: 305px;"><div class="arrow"></div></div>'),popoverContainer:angular.element('<div class="popover-content"></div>'),resize:{overlay:angular.element('<div class="ta-resizer-handle-overlay"></div>'),background:angular.element('<div class="ta-resizer-handle-background"></div>'),anchors:[angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-tr"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-bl"></div>'),angular.element('<div class="ta-resizer-handle-corner ta-resizer-handle-corner-br"></div>')],info:angular.element('<div class="ta-resizer-handle-info"></div>')}};scope.displayElements.popover.append(scope.displayElements.popoverContainer);scope.displayElements.scrollWindow.append(scope.displayElements.popover);scope.displayElements.popover.on("mousedown",function(e,eventData){if(eventData)angular.extend(e,eventData);e.preventDefault();return false});scope.showPopover=function(_el){scope.reflowPopover(_el);scope.displayElements.popover.css("display","block");$animate.addClass(scope.displayElements.popover,"in");oneEvent(element,"click keyup",function(){scope.hidePopover()})};scope.reflowPopover=function(_el){if(scope.displayElements.text[0].offsetHeight-51>_el[0].offsetTop){scope.displayElements.popover.css("top",_el[0].offsetTop+_el[0].offsetHeight+"px");scope.displayElements.popover.removeClass("top").addClass("bottom")}else{scope.displayElements.popover.css("top",_el[0].offsetTop-54+"px");scope.displayElements.popover.removeClass("bottom").addClass("top")}scope.displayElements.popover.css("left",Math.max(0,Math.min(scope.displayElements.text[0].offsetWidth-305,_el[0].offsetLeft+_el[0].offsetWidth/2-152.5))+"px")};scope.hidePopover=function(){$animate.removeClass(scope.displayElements.popover,"in",function(){scope.displayElements.popover.css("display","");scope.displayElements.popoverContainer.attr("style","");scope.displayElements.popoverContainer.attr("class","popover-content")})};scope.displayElements.resize.overlay.append(scope.displayElements.resize.background);angular.forEach(scope.displayElements.resize.anchors,function(anchor){scope.displayElements.resize.overlay.append(anchor)});scope.displayElements.resize.overlay.append(scope.displayElements.resize.info);scope.displayElements.scrollWindow.append(scope.displayElements.resize.overlay);scope.reflowResizeOverlay=function(_el){_el=angular.element(_el)[0];scope.displayElements.resize.overlay.css({display:"block",left:_el.offsetLeft-5+"px",top:_el.offsetTop-5+"px",width:_el.offsetWidth+10+"px",height:_el.offsetHeight+10+"px"});scope.displayElements.resize.info.text(_el.offsetWidth+" x "+_el.offsetHeight)};scope.showResizeOverlay=function(_el){var resizeMouseDown=function(event){var startPosition={width:parseInt(_el.attr("width")),height:parseInt(_el.attr("height")),x:event.clientX,y:event.clientY};if(startPosition.width===undefined)startPosition.width=_el[0].offsetWidth;if(startPosition.height===undefined)startPosition.height=_el[0].offsetHeight;scope.hidePopover();var ratio=startPosition.height/startPosition.width;var mousemove=function(event){var pos={x:Math.max(0,startPosition.width+(event.clientX-startPosition.x)),y:Math.max(0,startPosition.height+(event.clientY-startPosition.y))};var applyImageSafeCSS=function(_el,css){_el=angular.element(_el);if(_el[0].tagName.toLowerCase()==="img"){if(css.height){_el.attr("height",css.height);delete css.height}if(css.width){_el.attr("width",css.width);delete css.width}}_el.css(css)};if(event.shiftKey){var newRatio=pos.y/pos.x;applyImageSafeCSS(_el,{width:ratio>newRatio?pos.x:pos.y/ratio,height:ratio>newRatio?pos.x*ratio:pos.y})}else{applyImageSafeCSS(_el,{width:pos.x,height:pos.y})}scope.reflowResizeOverlay(_el)};$document.find("body").on("mousemove",mousemove);oneEvent(scope.displayElements.resize.overlay,"mouseup",function(){$document.find("body").off("mousemove",mousemove);scope.showPopover(_el)});event.stopPropagation();event.preventDefault()};scope.displayElements.resize.anchors[3].on("mousedown",resizeMouseDown);scope.reflowResizeOverlay(_el);oneEvent(element,"click",function(){scope.hideResizeOverlay()})};scope.hideResizeOverlay=function(){scope.displayElements.resize.overlay.css("display","")};scope.setup.htmlEditorSetup(scope.displayElements.html);scope.setup.textEditorSetup(scope.displayElements.text);scope.displayElements.html.attr({id:"taHtmlElement"+_serial,"ng-show":"showHtml","ta-bind":"ta-bind","ng-model":"html"});scope.displayElements.text.attr({id:"taTextElement"+_serial,contentEditable:!scope.taDisableTyping,"ta-bind":"ta-bind","ng-model":"html"});scope.displayElements.scrollWindow.attr({"ng-hide":"showHtml"});if(attrs.taDefaultWrap)scope.displayElements.text.attr("ta-default-wrap",attrs.taDefaultWrap);scope.displayElements.scrollWindow.append(scope.displayElements.text);element.append(scope.displayElements.scrollWindow);element.append(scope.displayElements.html);scope.displayElements.forminput.attr("name",_name);element.append(scope.displayElements.forminput);if(attrs.tabindex){element.removeAttr("tabindex");scope.displayElements.text.attr("tabindex",attrs.tabindex);scope.displayElements.html.attr("tabindex",attrs.tabindex)}if(attrs.placeholder){scope.displayElements.text.attr("placeholder",attrs.placeholder);scope.displayElements.html.attr("placeholder",attrs.placeholder)}scope.$watch("taDisableTyping",function(data){scope.displayElements.text.attr("contentEditable",!data)});scope.displayElements.text.attr("contentEditable",!scope.taDisableTyping);var disableTextAngular=function(value){if(!scope.taDisableTyping){scope.displayElements.text.attr("ta-readonly","disabled");scope.displayElements.html.attr("ta-readonly","disabled");scope.disabled=scope.$parent.$eval(attrs.taDisabled)}scope.$parent.$watch(attrs.taDisabled,function(newVal){scope.disabled=newVal;if(scope.disabled){element.addClass(scope.classes.disabled)}else{element.removeClass(scope.classes.disabled)}})};if(scope.taDisabled){disableTextAngular(scope.taDisabled)}scope.$watch("taDisabled",disableTextAngular);$compile(scope.displayElements.scrollWindow)(scope);$compile(scope.displayElements.html)(scope);scope.updateTaBindtaTextElement=scope["updateTaBindtaTextElement"+_serial];scope.updateTaBindtaHtmlElement=scope["updateTaBindtaHtmlElement"+_serial];element.addClass("ta-root");scope.displayElements.scrollWindow.addClass("ta-text ta-editor "+scope.classes.textEditor);scope.displayElements.html.addClass("ta-html ta-editor "+scope.classes.htmlEditor);scope._actionRunning=false;var _savedSelection=false;scope.startAction=function(){scope._actionRunning=true;if($window.rangy&&$window.rangy.saveSelection){_savedSelection=$window.rangy.saveSelection();return function(){if(_savedSelection)$window.rangy.restoreSelection(_savedSelection)}}};scope.endAction=function(){scope._actionRunning=false;if(_savedSelection)$window.rangy.removeMarkers(_savedSelection);_savedSelection=false;scope.updateSelectedStyles();if(!scope.showHtml)scope["updateTaBindtaTextElement"+_serial]()};_focusin=function(){element.addClass(scope.classes.focussed);_toolbars.focus()};scope.displayElements.html.on("focus",_focusin);scope.displayElements.text.on("focus",_focusin);_focusout=function(e){if(!scope._actionRunning&&$document[0].activeElement!==scope.displayElements.html[0]&&$document[0].activeElement!==scope.displayElements.text[0]){element.removeClass(scope.classes.focussed);_toolbars.unfocus();$timeout(function(){element.triggerHandler("blur")},0)}e.preventDefault();return false};scope.displayElements.html.on("blur",_focusout);scope.displayElements.text.on("blur",_focusout);scope.queryFormatBlockState=function(command){return command.toLowerCase()===$document[0].queryCommandValue("formatBlock").toLowerCase()};scope.switchView=function(){scope.showHtml=!scope.showHtml;if(scope.showHtml){$timeout(function(){return scope.displayElements.html[0].focus()},100)}else{$timeout(function(){return scope.displayElements.text[0].focus()},100)}};if(attrs.ngModel){var _firstRun=true;ngModel.$render=function(){if(_firstRun){_firstRun=false;var _initialValue=scope.$parent.$eval(attrs.ngModel);if((_initialValue===undefined||_initialValue===null)&&(_originalContents&&_originalContents!=="")){ngModel.$setViewValue(_originalContents)}}scope.displayElements.forminput.val(ngModel.$viewValue);if(!scope._elementSelectTriggered&&$document[0].activeElement!==scope.displayElements.html[0]&&$document[0].activeElement!==scope.displayElements.text[0]){scope.html=ngModel.$viewValue||""}}}else{scope.displayElements.forminput.val(_originalContents);scope.html=_originalContents}scope.$watch("html",function(newValue,oldValue){if(newValue!==oldValue){if(attrs.ngModel&&ngModel.$viewValue!==newValue)ngModel.$setViewValue(newValue);scope.displayElements.forminput.val(newValue)}});if(attrs.taTargetToolbars)_toolbars=textAngularManager.registerEditor(_name,scope,attrs.taTargetToolbars.split(","));else{var _toolbar=angular.element('<div text-angular-toolbar name="textAngularToolbar'+_serial+'">');if(attrs.taToolbar)_toolbar.attr("ta-toolbar",attrs.taToolbar);if(attrs.taToolbarClass)_toolbar.attr("ta-toolbar-class",attrs.taToolbarClass);if(attrs.taToolbarGroupClass)_toolbar.attr("ta-toolbar-group-class",attrs.taToolbarGroupClass);if(attrs.taToolbarButtonClass)_toolbar.attr("ta-toolbar-button-class",attrs.taToolbarButtonClass);if(attrs.taToolbarActiveButtonClass)_toolbar.attr("ta-toolbar-active-button-class",attrs.taToolbarActiveButtonClass);if(attrs.taFocussedClass)_toolbar.attr("ta-focussed-class",attrs.taFocussedClass);element.prepend(_toolbar);$compile(_toolbar)(scope.$parent);_toolbars=textAngularManager.registerEditor(_name,scope,["textAngularToolbar"+_serial])}scope.$on("$destroy",function(){textAngularManager.unregisterEditor(_name)});scope.$on("ta-element-select",function(event,element){_toolbars.triggerElementSelect(event,element)});scope.$on("ta-drop-event",function(event,element,dropEvent,dataTransfer){scope.displayElements.text[0].focus();if(dataTransfer&&dataTransfer.files&&dataTransfer.files.length>0){angular.forEach(dataTransfer.files,function(file){try{return scope.fileDropHandler(file,scope.wrapSelection)||scope.fileDropHandler!==scope.defaultFileDropHandler&&scope.defaultFileDropHandler(file,scope.wrapSelection)}catch(error){$log.error(error)}});dropEvent.preventDefault();dropEvent.stopPropagation()}});scope._bUpdateSelectedStyles=false;scope.updateSelectedStyles=function(){var _selection;if((_selection=taSelection.getSelectionElement())!==undefined&&_selection.parentNode!==scope.displayElements.text[0]){_toolbars.updateSelectedStyles(angular.element(_selection))
}else _toolbars.updateSelectedStyles();if(scope._bUpdateSelectedStyles)$timeout(scope.updateSelectedStyles,200)};_keydown=function(){if(!scope._bUpdateSelectedStyles){scope._bUpdateSelectedStyles=true;scope.$apply(function(){scope.updateSelectedStyles()})}};scope.displayElements.html.on("keydown",_keydown);scope.displayElements.text.on("keydown",_keydown);_keyup=function(){scope._bUpdateSelectedStyles=false};scope.displayElements.html.on("keyup",_keyup);scope.displayElements.text.on("keyup",_keyup);_keypress=function(event,eventData){if(eventData)angular.extend(event,eventData);scope.$apply(function(){if(_toolbars.sendKeyCommand(event)){if(!scope._bUpdateSelectedStyles){scope.updateSelectedStyles()}event.preventDefault();return false}})};scope.displayElements.html.on("keypress",_keypress);scope.displayElements.text.on("keypress",_keypress);_mouseup=function(){scope._bUpdateSelectedStyles=false;scope.$apply(function(){scope.updateSelectedStyles()})};scope.displayElements.html.on("mouseup",_mouseup);scope.displayElements.text.on("mouseup",_mouseup)}}}]).factory("taBrowserTag",[function(){return function(tag){if(!tag)return ie<=8?"P":"p";else if(tag==="")return ie===undefined?"div":ie<=8?"P":"p";else return ie<=8?tag.toUpperCase():tag}}]).factory("taExecCommand",["taSelection","taBrowserTag","$document",function(taSelection,taBrowserTag,$document){var BLOCKELEMENTS=/(address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)/gi;var LISTELEMENTS=/(ul|li|ol)/gi;var listToDefault=function(listElement,defaultWrap){var $target;var children=listElement.find("li");for(i=children.length-1;i>=0;i--){$target=angular.element("<"+defaultWrap+">"+children[i].innerHTML+"</"+defaultWrap+">");listElement.after($target)}listElement.remove();taSelection.setSelectionToElementEnd($target[0])};var listToList=function(listElement,newListTag){var $target=angular.element("<"+newListTag+">"+listElement[0].innerHTML+"</"+newListTag+">");listElement.after($target);listElement.remove();taSelection.setSelectionToElementEnd($target.find("li")[0])};var childElementsToList=function(elements,listElement,newListTag){var html="";for(i=elements.length-1;i>=0;i--){html+="<"+taBrowserTag("li")+">"+elements[i].innerHTML+"</"+taBrowserTag("li")+">"}var $target=angular.element("<"+newListTag+">"+html+"</"+newListTag+">");listElement.after($target);listElement.remove();taSelection.setSelectionToElementEnd($target.find("li")[0])};return function(taDefaultWrap){taDefaultWrap=taBrowserTag(taDefaultWrap);return function(command,showUI,options){var i,$target,html,_nodes,next;var defaultWrapper=angular.element("<"+taDefaultWrap+">");var selectedElement=taSelection.getSelectionElement();var $selected=angular.element(selectedElement);if(selectedElement!==undefined){var tagName=selectedElement.tagName.toLowerCase();if(command.toLowerCase()==="insertorderedlist"||command.toLowerCase()==="insertunorderedlist"){var selfTag=taBrowserTag(command.toLowerCase()==="insertorderedlist"?"ol":"ul");if(tagName===selfTag){return listToDefault($selected,taDefaultWrap)}else if(tagName==="li"&&$selected.parent()[0].tagName.toLowerCase()===selfTag&&$selected.parent().children().length===1){return listToDefault($selected.parent(),taDefaultWrap)}else if(tagName==="li"&&$selected.parent()[0].tagName.toLowerCase()!==selfTag&&$selected.parent().children().length===1){return listToList($selected.parent(),selfTag)}else if(tagName.match(BLOCKELEMENTS)&&!$selected.hasClass("ta-bind")){if(tagName==="ol"||tagName==="ul"){return listToList($selected,selfTag)}else{if(selectedElement.innerHTML.match(BLOCKELEMENTS)){return childElementsToList($selected.children(),$selected,selfTag)}else{return childElementsToList(angular.element("<div>"+selectedElement.innerHTML+"</div>"),$selected,selfTag)}}}else if(tagName.match(BLOCKELEMENTS)){_nodes=taSelection.getOnlySelectedElements();if(_nodes.length===1&&(_nodes[0].tagName.toLowerCase()==="ol"||_nodes[0].tagName.toLowerCase()==="ul")){if(_nodes[0].tagName.toLowerCase()===selfTag){return listToDefault(angular.element(_nodes[0]),taDefaultWrap)}else{return listToList(angular.element(_nodes[0]),selfTag)}}else{html="";var $nodes=[];for(i=0;i<_nodes.length;i++){if(_nodes[i].nodeType!==3){var $n=angular.element(_nodes[i]);html+="<"+taBrowserTag("li")+">"+$n[0].innerHTML+"</"+taBrowserTag("li")+">";$nodes.unshift($n)}}$target=angular.element("<"+selfTag+">"+html+"</"+selfTag+">");$nodes.pop().replaceWith($target);angular.forEach($nodes,function($node){$node.remove()})}taSelection.setSelectionToElementEnd($target[0]);return}}else if(command.toLowerCase()==="formatblock"&&"blockquote"===options.toLowerCase().replace(/[<>]/gi,"")){if(tagName==="li")$target=$selected.parent();else $target=$selected;while(!$target[0].tagName.match(BLOCKELEMENTS)){$target=$target.parent();tagName=$target[0].tagName.toLowerCase()}if(tagName===options.toLowerCase().replace(/[<>]/gi,"")){_nodes=$target.children();var hasBlock=false;for(i=0;i<_nodes.length;i++){hasBlock=hasBlock||_nodes[i].tagName.match(BLOCKELEMENTS)}if(hasBlock){$target.after(_nodes);next=$target.next();$target.remove();$target=next}else{defaultWrapper.append($target[0].childNodes);$target.after(defaultWrapper);$target.remove();$target=defaultWrapper}}else if($target.parent()[0].tagName.toLowerCase()===options.toLowerCase().replace(/[<>]/gi,"")&&!$target.parent().hasClass("ta-bind")){var blockElement=$target.parent();var contents=blockElement.contents();for(i=0;i<contents.length;i++){if(blockElement.parent().hasClass("ta-bind")&&contents[i].nodeType===3){defaultWrapper=angular.element("<"+taDefaultWrap+">");defaultWrapper[0].innerHTML=contents[i].outerHTML;contents[i]=defaultWrapper[0]}blockElement.parent()[0].insertBefore(contents[i],blockElement[0])}blockElement.remove()}else if(tagName.match(LISTELEMENTS)){$target.wrap(options)}else{_nodes=taSelection.getOnlySelectedElements();if(_nodes.length===0)_nodes=[$target[0]];html="";if(_nodes.length===1&&_nodes[0].nodeType===3){var _node=_nodes[0].parentNode;while(!_node.tagName.match(BLOCKELEMENTS)){_node=_node.parentNode}_nodes=[_node]}for(i=0;i<_nodes.length;i++){html+=_nodes[i].outerHTML}$target=angular.element(options);$target[0].innerHTML=html;_nodes[0].parentNode.insertBefore($target[0],_nodes[0]);angular.forEach(_nodes,function(node){node.parentNode.removeChild(node)})}taSelection.setSelectionToElementEnd($target[0]);return}}try{$document[0].execCommand(command,showUI,options)}catch(e){}}}}]).directive("taBind",["taSanitize","$timeout","$window","$document","taFixChrome","taBrowserTag","taSelection","taSelectableElements","taApplyCustomRenderers",function(taSanitize,$timeout,$window,$document,taFixChrome,taBrowserTag,taSelection,taSelectableElements,taApplyCustomRenderers){return{require:"ngModel",scope:{},link:function(scope,element,attrs,ngModel){var _isContentEditable=element.attr("contenteditable")!==undefined&&element.attr("contenteditable");var _isInputFriendly=_isContentEditable||element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input";var _isReadonly=false;var _focussed=false;var _defaultVal,_defaultTest;if(attrs.taDefaultWrap===undefined)attrs.taDefaultWrap="p";if(attrs.taDefaultWrap===""){_defaultVal="";_defaultTest=ie===undefined?"<div><br></div>":ie>=11?"<p><br></p>":ie<=8?"<P>&nbsp;</P>":"<p>&nbsp;</p>"}else{_defaultVal=ie===undefined||ie>=11?"<"+attrs.taDefaultWrap+"><br></"+attrs.taDefaultWrap+">":ie<=8?"<"+attrs.taDefaultWrap.toUpperCase()+"></"+attrs.taDefaultWrap.toUpperCase()+">":"<"+attrs.taDefaultWrap+"></"+attrs.taDefaultWrap+">";_defaultTest=ie===undefined||ie>=11?"<"+attrs.taDefaultWrap+"><br></"+attrs.taDefaultWrap+">":ie<=8?"<"+attrs.taDefaultWrap.toUpperCase()+">&nbsp;</"+attrs.taDefaultWrap.toUpperCase()+">":"<"+attrs.taDefaultWrap+">&nbsp;</"+attrs.taDefaultWrap+">"}element.addClass("ta-bind");var _compileHtml=function(){if(_isContentEditable)return element[0].innerHTML;if(_isInputFriendly)return element.val();throw"textAngular Error: attempting to update non-editable taBind"};scope.$parent["updateTaBind"+(attrs.id||"")]=function(){if(!_isReadonly)ngModel.$setViewValue(_compileHtml())};if(_isInputFriendly){if(!_isContentEditable){element.on("paste cut",function(){if(!_isReadonly)$timeout(function(){ngModel.$setViewValue(_compileHtml())},0)});element.on("change blur",function(){if(!_isReadonly)ngModel.$setViewValue(_compileHtml())})}else{element.on("cut",function(e){if(!_isReadonly)$timeout(function(){ngModel.$setViewValue(_compileHtml())},0);else e.preventDefault()});element.on("paste",function(e,eventData){if(eventData)angular.extend(e,eventData);var text;if(e.clipboardData||e.originalEvent&&e.originalEvent.clipboardData)text=(e.originalEvent||e).clipboardData.getData("text/plain");else if($window.clipboardData)text=$window.clipboardData.getData("Text");if(!text&&!_isReadonly)return true;e.preventDefault();if(!_isReadonly){var _working=angular.element("<div></div>");_working[0].innerHTML=text;text=_working.text();if($document[0].selection){var range=$document[0].selection.createRange();range.pasteHTML(text)}else{$document[0].execCommand("insertText",false,text)}ngModel.$setViewValue(_compileHtml())}});element.on("keyup",function(event,eventData){if(eventData)angular.extend(event,eventData);if(!_isReadonly){if(_defaultVal!==""&&event.keyCode===13){if(!event.shiftKey){var selection=taSelection.getSelectionElement();if(selection.tagName.toLowerCase()!==attrs.taDefaultWrap&&selection.tagName.toLowerCase()!=="li"&&(selection.innerHTML.trim()===""||selection.innerHTML.trim()==="<br>")){var _new=angular.element(_defaultVal);angular.element(selection).replaceWith(_new);taSelection.setSelectionToElementStart(_new[0])}}}var val=_compileHtml();if(_defaultVal!==""&&val.trim()===""){element[0].innerHTML=_defaultVal;taSelection.setSelectionToElementStart(element.children()[0])}ngModel.$setViewValue(val)}});element.on("blur",function(){_focussed=false;var val=_compileHtml();if(!_isReadonly){if(val===_defaultTest)ngModel.$setViewValue("");else ngModel.$setViewValue(_compileHtml())}ngModel.$render()});if(attrs.placeholder&&(ie>8||ie===undefined)){var ruleIndex;if(attrs.id)ruleIndex=addCSSRule("#"+attrs.id+".placeholder-text:before",'content: "'+attrs.placeholder+'"');else throw"textAngular Error: An unique ID is required for placeholders to work";scope.$on("$destroy",function(){removeCSSRule(ruleIndex)})}element.on("focus",function(){_focussed=true;ngModel.$render()})}}var _sanitize=function(unsafe){return ngModel.$oldViewValue=taSanitize(taFixChrome(unsafe),ngModel.$oldViewValue)};ngModel.$parsers.push(_sanitize);ngModel.$formatters.push(_sanitize);var selectorClickHandler=function(event){scope.$emit("ta-element-select",this);event.preventDefault();return false};var fileDropHandler=function(event,eventData){if(eventData)angular.extend(event,eventData);if(!dropFired&&!_isReadonly){dropFired=true;var dataTransfer;if(event.originalEvent)dataTransfer=event.originalEvent.dataTransfer;else dataTransfer=event.dataTransfer;scope.$emit("ta-drop-event",this,event,dataTransfer);$timeout(function(){dropFired=false},100)}};scope.$parent["reApplyOnSelectorHandlers"+(attrs.id||"")]=function(){if(!_isReadonly)angular.forEach(taSelectableElements,function(selector){element.find(selector).off("click",selectorClickHandler).on("click",selectorClickHandler)})};ngModel.$render=function(){var val=ngModel.$viewValue||"";if($document[0].activeElement!==element[0]){if(_isContentEditable){if(attrs.placeholder){if(val===""){if(_focussed)element.removeClass("placeholder-text");else element.addClass("placeholder-text");element[0].innerHTML=_defaultVal}else{element.removeClass("placeholder-text");element[0].innerHTML=val}}else{if(val==="")element[0].innerHTML=_defaultVal;else element[0].innerHTML=val}if(!_isReadonly){angular.forEach(taSelectableElements,function(selector){element.find(selector).on("click",selectorClickHandler)});element.on("drop",fileDropHandler)}else{element.off("drop",fileDropHandler)}}else if(element[0].tagName.toLowerCase()!=="textarea"&&element[0].tagName.toLowerCase()!=="input"){element[0].innerHTML=taApplyCustomRenderers(val)}else{element.val(val)}}else{if(_isContentEditable){element.removeClass("placeholder-text")}}};if(attrs.taReadonly){_isReadonly=scope.$parent.$eval(attrs.taReadonly);if(_isReadonly){element.addClass("ta-readonly");if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input"){element.attr("disabled","disabled")}if(element.attr("contenteditable")!==undefined&&element.attr("contenteditable")){element.removeAttr("contenteditable")}}else{element.removeClass("ta-readonly");if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input"){element.removeAttr("disabled")}else if(_isContentEditable){element.attr("contenteditable","true")}}scope.$parent.$watch(attrs.taReadonly,function(newVal,oldVal){if(oldVal===newVal)return;if(newVal){element.addClass("ta-readonly");if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input"){element.attr("disabled","disabled")}if(element.attr("contenteditable")!==undefined&&element.attr("contenteditable")){element.removeAttr("contenteditable")}angular.forEach(taSelectableElements,function(selector){element.find(selector).on("click",selectorClickHandler)});element.off("drop",fileDropHandler)}else{element.removeClass("ta-readonly");if(element[0].tagName.toLowerCase()==="textarea"||element[0].tagName.toLowerCase()==="input"){element.removeAttr("disabled")}else if(_isContentEditable){element.attr("contenteditable","true")}angular.forEach(taSelectableElements,function(selector){element.find(selector).off("click",selectorClickHandler)});element.on("drop",fileDropHandler)}_isReadonly=newVal})}if(_isContentEditable&&!_isReadonly){angular.forEach(taSelectableElements,function(selector){element.find(selector).on("click",selectorClickHandler)});element.on("drop",fileDropHandler);element.on("blur",function(){if(/AppleWebKit\/([\d.]+)/.exec(navigator.userAgent)){globalContentEditableBlur=true}})}}}}]).factory("taApplyCustomRenderers",["taCustomRenderers",function(taCustomRenderers){return function(val){var element=angular.element("<div></div>");element[0].innerHTML=val;angular.forEach(taCustomRenderers,function(renderer){var elements=[];if(renderer.selector&&renderer.selector!=="")elements=element.find(renderer.selector);else if(renderer.customAttribute&&renderer.customAttribute!=="")elements=getByAttribute(element,renderer.customAttribute);angular.forEach(elements,function(_element){_element=angular.element(_element);if(renderer.selector&&renderer.selector!==""&&renderer.customAttribute&&renderer.customAttribute!==""){if(_element.attr(renderer.customAttribute)!==undefined)renderer.renderLogic(_element)}else renderer.renderLogic(_element)})});return element[0].innerHTML}}]).directive("taMaxText",function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attrs,ctrl){var max=parseInt(scope.$eval(attrs.taMaxText));if(isNaN(max)){throw"Max text must be an integer"}attrs.$observe("taMaxText",function(value){max=parseInt(value);if(isNaN(max)){throw"Max text must be an integer"}if(ctrl.$dirty){ctrl.$setViewValue(ctrl.$viewValue)}});function validator(viewValue){var source=angular.element("<div/>");source.html(viewValue);var length=source.text().length;if(length<=max){ctrl.$setValidity("taMaxText",true);return viewValue}else{ctrl.$setValidity("taMaxText",false);return undefined}}ctrl.$parsers.unshift(validator)}}}).directive("taMinText",function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attrs,ctrl){var min=parseInt(scope.$eval(attrs.taMinText));if(isNaN(min)){throw"Min text must be an integer"}attrs.$observe("taMinText",function(value){min=parseInt(value);if(isNaN(min)){throw"Min text must be an integer"}if(ctrl.$dirty){ctrl.$setViewValue(ctrl.$viewValue)}});function validator(viewValue){var source=angular.element("<div/>");source.html(viewValue);var length=source.text().length;if(!length||length>=min){ctrl.$setValidity("taMinText",true);return viewValue}else{ctrl.$setValidity("taMinText",false);return undefined}}ctrl.$parsers.unshift(validator)}}}).directive("taWriteDisabled",[function(){return{restrict:"A",require:"^textAngular",link:function($scope,$element,$attrs,textAngularCtrl){var textEditorComponent=textAngularCtrl.getDisplayElements().text;textEditorComponent.attr("contentEditable","false");angular.forEach($element.find("button"),function(button){angular.element(button).scope().isDisabled=function(){return false}})}}}]).factory("taFixChrome",function(){var taFixChrome=function(html){var $html=angular.element("<div>"+html+"</div>");var spans=angular.element($html).find("span");for(var s=0;s<spans.length;s++){var span=angular.element(spans[s]);if(span.attr("style")&&span.attr("style").match(/line-height: 1.428571429;|color: inherit; line-height: 1.1;/i)){span.attr("style",span.attr("style").replace(/( |)font-family: inherit;|( |)line-height: 1.428571429;|( |)line-height:1.1;|( |)color: inherit;/gi,""));if(!span.attr("style")||span.attr("style")===""){if(span.next().length>0&&span.next()[0].tagName==="BR")span.next().remove();span.replaceWith(span[0].innerHTML)}}}var result=$html[0].innerHTML.replace(/style="[^"]*?(line-height: 1.428571429;|color: inherit; line-height: 1.1;)[^"]*"/gi,"");if(result!==$html[0].innerHTML)$html[0].innerHTML=result;return $html[0].innerHTML};return taFixChrome}).factory("taSanitize",["$sanitize",function taSanitizeFactory($sanitize){return function taSanitize(unsafe,oldsafe){var unsafeElement=angular.element("<div>"+unsafe+"</div>");angular.forEach(getByAttribute(unsafeElement,"align"),function(element){element.css("text-align",element.attr("align"));element.removeAttr("align")});unsafe=unsafeElement[0].innerHTML;var safe;try{safe=$sanitize(unsafe)}catch(e){safe=oldsafe||""}return safe}}]).directive("textAngularToolbar",["$compile","textAngularManager","taOptions","taTools","taToolExecuteAction","$window",function($compile,textAngularManager,taOptions,taTools,taToolExecuteAction,$window){return{scope:{name:"@"},require:"^textAngular",restrict:"EA",link:function(scope,element,attrs,textAngularCtrl){if(!scope.name||scope.name==="")throw"textAngular Error: A toolbar requires a name";angular.extend(scope,angular.copy(taOptions));if(attrs.taToolbar)scope.toolbar=scope.$parent.$eval(attrs.taToolbar);if(attrs.taToolbarClass)scope.classes.toolbar=attrs.taToolbarClass;if(attrs.taToolbarGroupClass)scope.classes.toolbarGroup=attrs.taToolbarGroupClass;if(attrs.taToolbarButtonClass)scope.classes.toolbarButton=attrs.taToolbarButtonClass;if(attrs.taToolbarActiveButtonClass)scope.classes.toolbarButtonActive=attrs.taToolbarActiveButtonClass;if(attrs.taFocussedClass)scope.classes.focussed=attrs.taFocussedClass;scope.disabled=true;scope.focussed=false;scope._$element=element;element[0].innerHTML="";element.addClass("ta-toolbar "+scope.classes.toolbar);scope.$watch("focussed",function(){if(scope.focussed)element.addClass(scope.classes.focussed);else element.removeClass(scope.classes.focussed)});var setupToolElement=function(toolDefinition,toolScope){var toolElement;if(toolDefinition&&toolDefinition.display){toolElement=angular.element(toolDefinition.display)}else toolElement=angular.element("<button type='button'>");toolElement.addClass(scope.classes.toolbarButton);toolElement.attr("name",toolScope.name);toolElement.attr("unselectable","on");toolElement.attr("ng-disabled","isDisabled()");toolElement.attr("tabindex","-1");toolElement.attr("ng-click","executeAction()");toolElement.attr("ng-class","displayActiveToolClass(active)");toolElement.on("mousedown",function(e,eventData){if(eventData)angular.extend(e,eventData);e.preventDefault();return false});if(toolDefinition&&!toolDefinition.display&&!toolScope._display){toolElement[0].innerHTML="";if(toolDefinition.buttontext)toolElement[0].innerHTML=toolDefinition.buttontext;if(toolDefinition.iconclass){var icon=angular.element("<i>"),content=toolElement[0].innerHTML;icon.addClass(toolDefinition.iconclass);toolElement[0].innerHTML="";toolElement.append(icon);if(content&&content!=="")toolElement.append("&nbsp;"+content)}}toolScope._lastToolDefinition=angular.copy(toolDefinition);return $compile(toolElement)(toolScope)};scope.tools={};scope._parent={disabled:true,showHtml:false,queryFormatBlockState:function(){return false},displayElements:textAngularCtrl.getDisplayElements(),taScope:textAngularCtrl.getTaScope()};var defaultChildScope={$window:$window,$editor:function(){return scope._parent},isDisabled:function(){var taScope=textAngularCtrl.getTaScope(),isTypingDisabled=taScope.taDisableTyping,isTaDisabled=taScope.taDisabled;return this.$eval("disabled")||this.$eval("disabled()")||this.name!=="html"&&this.$editor().showHtml||isTaDisabled},displayActiveToolClass:function(active){return active?scope.classes.toolbarButtonActive:""},executeAction:taToolExecuteAction};angular.forEach(scope.toolbar,function(group){var groupElement=angular.element("<div>");groupElement.addClass(scope.classes.toolbarGroup);angular.forEach(group,function(tool){scope.tools[tool]=angular.extend(scope.$new(true),taTools[tool],defaultChildScope,{name:tool});scope.tools[tool].$element=setupToolElement(taTools[tool],scope.tools[tool]);groupElement.append(scope.tools[tool].$element)});element.append(groupElement)});scope.updateToolDisplay=function(key,_newTool,forceNew){var toolInstance=scope.tools[key];if(toolInstance){if(toolInstance._lastToolDefinition&&!forceNew)_newTool=angular.extend({},toolInstance._lastToolDefinition,_newTool);if(_newTool.buttontext===null&&_newTool.iconclass===null&&_newTool.display===null)throw'textAngular Error: Tool Definition for updating "'+key+'" does not have a valid display/iconclass/buttontext value';if(_newTool.buttontext===null){delete _newTool.buttontext}if(_newTool.iconclass===null){delete _newTool.iconclass}if(_newTool.display===null){delete _newTool.display}var toolElement=setupToolElement(_newTool,toolInstance);toolInstance.$element.replaceWith(toolElement);toolInstance.$element=toolElement}};scope.addTool=function(key,_newTool,groupIndex,index){scope.tools[key]=angular.extend(scope.$new(true),taTools[key],defaultChildScope,{name:key});scope.tools[key].$element=setupToolElement(taTools[key],scope.tools[key]);var group;if(groupIndex===undefined)groupIndex=scope.toolbar.length-1;group=angular.element(element.children()[groupIndex]);if(index===undefined){group.append(scope.tools[key].$element);scope.toolbar[groupIndex][scope.toolbar[groupIndex].length-1]=key}else{group.children().eq(index).after(scope.tools[key].$element);scope.toolbar[groupIndex][index]=key}};textAngularManager.registerToolbar(scope);scope.$on("$destroy",function(){textAngularManager.unregisterToolbar(scope.name)})}}}]).service("taToolExecuteAction",["$q",function($q){return function(editor){if(editor!==undefined)this.$editor=function(){return editor};var deferred=$q.defer(),promise=deferred.promise,_editor=this.$editor();promise["finally"](function(){_editor.endAction.call(_editor)});var result;try{result=this.action(deferred,_editor&&_editor.startAction&&angular.isFunction(_editor.startAction)?_editor.startAction():null)}catch(any){}if(result||result===undefined){deferred.resolve()}}}]).service("textAngularManager",["taToolExecuteAction","taTools","taRegisterTool",function(taToolExecuteAction,taTools,taRegisterTool){var toolbars={},editors={};return{registerEditor:function(name,scope,targetToolbars){if(!name||name==="")throw"textAngular Error: An editor requires a name";if(!scope)throw"textAngular Error: An editor requires a scope";if(editors[name])throw'textAngular Error: An Editor with name "'+name+'" already exists';var _toolbars=[];angular.forEach(targetToolbars,function(_name){if(toolbars[_name])_toolbars.push(toolbars[_name])});editors[name]={scope:scope,toolbars:targetToolbars,_registerToolbar:function(toolbarScope){if(this.toolbars.indexOf(toolbarScope.name)>=0)_toolbars.push(toolbarScope)},editorFunctions:{disable:function(){angular.forEach(_toolbars,function(toolbarScope){toolbarScope.disabled=true})},enable:function(){angular.forEach(_toolbars,function(toolbarScope){toolbarScope.disabled=false})},focus:function(){angular.forEach(_toolbars,function(toolbarScope){toolbarScope._parent=scope;toolbarScope.disabled=false;toolbarScope.focussed=true})},unfocus:function(){angular.forEach(_toolbars,function(toolbarScope){toolbarScope.disabled=true;toolbarScope.focussed=false})},updateSelectedStyles:function(selectedElement){angular.forEach(_toolbars,function(toolbarScope){angular.forEach(toolbarScope.tools,function(toolScope){if(toolScope.activeState){toolScope.active=toolScope.activeState(selectedElement)}})})},sendKeyCommand:function(event){var result=false;if(event.ctrlKey||event.metaKey)angular.forEach(taTools,function(tool,name){if(tool.commandKeyCode&&tool.commandKeyCode===event.which){for(var _t=0;_t<_toolbars.length;_t++){if(_toolbars[_t].tools[name]!==undefined){taToolExecuteAction.call(_toolbars[_t].tools[name],scope);result=true;break}}}});return result},triggerElementSelect:function(event,element){var elementHasAttrs=function(_element,attrs){var result=true;for(var i=0;i<attrs.length;i++)result=result&&_element.attr(attrs[i]);return result};var workerTools=[];var unfilteredTools={};var result=false;element=angular.element(element);var onlyWithAttrsFilter=false;angular.forEach(taTools,function(tool,name){if(tool.onElementSelect&&tool.onElementSelect.element&&tool.onElementSelect.element.toLowerCase()===element[0].tagName.toLowerCase()&&(!tool.onElementSelect.filter||tool.onElementSelect.filter(element))){onlyWithAttrsFilter=onlyWithAttrsFilter||angular.isArray(tool.onElementSelect.onlyWithAttrs)&&elementHasAttrs(element,tool.onElementSelect.onlyWithAttrs);if(!tool.onElementSelect.onlyWithAttrs||elementHasAttrs(element,tool.onElementSelect.onlyWithAttrs))unfilteredTools[name]=tool}});if(onlyWithAttrsFilter){angular.forEach(unfilteredTools,function(tool,name){if(tool.onElementSelect.onlyWithAttrs&&elementHasAttrs(element,tool.onElementSelect.onlyWithAttrs))workerTools.push({name:name,tool:tool})});workerTools.sort(function(a,b){return b.tool.onElementSelect.onlyWithAttrs.length-a.tool.onElementSelect.onlyWithAttrs.length})}else{angular.forEach(unfilteredTools,function(tool,name){workerTools.push({name:name,tool:tool})})}if(workerTools.length>0){var tool=workerTools[0].tool;var name=workerTools[0].name;for(var _t=0;_t<_toolbars.length;_t++){if(_toolbars[_t].tools[name]!==undefined){tool.onElementSelect.action.call(_toolbars[_t].tools[name],event,element,scope);result=true;break}}}return result}}};return editors[name].editorFunctions},retrieveEditor:function(name){return editors[name]},unregisterEditor:function(name){delete editors[name]},registerToolbar:function(scope){if(!scope)throw"textAngular Error: A toolbar requires a scope";if(!scope.name||scope.name==="")throw"textAngular Error: A toolbar requires a name";if(toolbars[scope.name])throw'textAngular Error: A toolbar with name "'+scope.name+'" already exists';toolbars[scope.name]=scope;angular.forEach(editors,function(_editor){_editor._registerToolbar(scope)})},retrieveToolbar:function(name){return toolbars[name]},retrieveToolbarsViaEditor:function(name){var result=[],_this=this;angular.forEach(this.retrieveEditor(name).toolbars,function(name){result.push(_this.retrieveToolbar(name))});return result},unregisterToolbar:function(name){delete toolbars[name]},updateToolsDisplay:function(newTaTools){var _this=this;angular.forEach(newTaTools,function(_newTool,key){_this.updateToolDisplay(key,_newTool)})},resetToolsDisplay:function(){var _this=this;angular.forEach(taTools,function(_newTool,key){_this.resetToolDisplay(key)})},updateToolDisplay:function(toolKey,_newTool){var _this=this;angular.forEach(toolbars,function(toolbarScope,toolbarKey){_this.updateToolbarToolDisplay(toolbarKey,toolKey,_newTool)})},resetToolDisplay:function(toolKey){var _this=this;angular.forEach(toolbars,function(toolbarScope,toolbarKey){_this.resetToolbarToolDisplay(toolbarKey,toolKey)})},updateToolbarToolDisplay:function(toolbarKey,toolKey,_newTool){if(toolbars[toolbarKey])toolbars[toolbarKey].updateToolDisplay(toolKey,_newTool);else throw'textAngular Error: No Toolbar with name "'+toolbarKey+'" exists'},resetToolbarToolDisplay:function(toolbarKey,toolKey){if(toolbars[toolbarKey])toolbars[toolbarKey].updateToolDisplay(toolKey,taTools[toolKey],true);else throw'textAngular Error: No Toolbar with name "'+toolbarKey+'" exists'},removeTool:function(toolKey){delete taTools[toolKey];angular.forEach(toolbars,function(toolbarScope){delete toolbarScope.tools[toolKey];for(var i=0;i<toolbarScope.toolbar.length;i++){var toolbarIndex;for(var j=0;j<toolbarScope.toolbar[i].length;j++){if(toolbarScope.toolbar[i][j]===toolKey){toolbarIndex={group:i,index:j};break}if(toolbarIndex!==undefined)break}if(toolbarIndex!==undefined){toolbarScope.toolbar[toolbarIndex.group].slice(toolbarIndex.index,1);toolbarScope._$element.children().eq(toolbarIndex.group).children().eq(toolbarIndex.index).remove()}}})},addTool:function(toolKey,toolDefinition,group,index){taRegisterTool(toolKey,toolDefinition);angular.forEach(toolbars,function(toolbarScope){toolbarScope.addTool(toolKey,toolDefinition,group,index)})},addToolToToolbar:function(toolKey,toolDefinition,toolbarKey,group,index){taRegisterTool(toolKey,toolDefinition);toolbars[toolbarKey].addTool(toolKey,toolDefinition,group,index)},refreshEditor:function(name){if(editors[name]){editors[name].scope.updateTaBindtaTextElement();if(!editors[name].scope.$$phase)editors[name].scope.$digest()}else throw'textAngular Error: No Editor with name "'+name+'" exists'}}}]).service("taSelection",["$window","$document","textAngular",function($window,$document,textAngular){_document=$document[0];var nextNode=function(node){if(node.hasChildNodes()){return node.firstChild}else{while(node&&!node.nextSibling){node=node.parentNode}if(!node){return null}return node.nextSibling}};var cleanSelection=function(){if($window.getSelection){var sel=$window.getSelection();cleanRanges();sel.collapseToEnd()}return null};var getRange=function(){if($window.getSelection){var sel=$window.getSelection();if(!sel.isCollapsed){return sel.getRangeAt(0)}}return null};var cleanRanges=function(){var sel=window.getSelection(),range;if(sel.rangeCount>1){for(var i=1;i<sel.rangeCount;i++){range=sel.getRangeAt(i);range.detach();sel.removeRange(range)}}};var getOnlySelectedElements=function(){var range=getRange();return range?getRangeSelectedNodes(range):[]};var getRangeSelectedNodes=function(range){var node=range.startContainer;var endNode=range.endContainer;if(node===endNode){return[node]}var rangeNodes=[];while(node&&node!==endNode){node=nextNode(node);if(node.parentNode===range.commonAncestorContainer)rangeNodes.push(node)}node=range.startContainer;while(node&&node!==range.commonAncestorContainer){if(node.parentNode===range.commonAncestorContainer)rangeNodes.unshift(node);node=node.parentNode}return rangeNodes};var wrapTextNode=function(container,start,end,tagName,direction){var subRange,wrapperNode;if(start<end){wrapperNode=$document[0].createElement(tagName);subRange=$document[0].createRange();subRange.setStart(container,start);subRange.setEnd(container,end);subRange.surroundContents(wrapperNode)}return container.nextSibling};var wrapNode=function(node,tagName){var wrapperNode,subRange;if(node.nodeType===3&&node.textContent.length===0){}else if(node.nodeName.toLowerCase()!==tagName.toLowerCase()){wrapperNode=$document[0].createElement(tagName);subRange=$document[0].createRange();if(node.nodeType===3){subRange.setStart(node,0);subRange.setEnd(node,node.textContent.length)}else{node.insertAdjacentHTML("beforeEnd",".");subRange.setEnd(node.lastChild,0);node.removeChild(node.lastChild);node.insertAdjacentHTML("afterBegin",".");
subRange.setStart(node.firstChild,0);node.removeChild(node.firstChild)}subRange.surroundContents(wrapperNode)}return node};var cleanTree=function(node,tagName,clear){if(node){if(node.nodeName.toLowerCase()===tagName){if(clear){node.outerHTML=node.innerHTML}else{clear=true}}angular.forEach(node.children,function(child){cleanTree(child,tagName,clear)})}};var wrapUp=function(range,actCont,tagName,direction){var tree={topNode:range.commonAncestorContainer,leftBranch:{startNode:null,topNode:null},rightBranch:{startNode:null,topNode:null}},getSibling=function(node,direction){var sibling=node[direction?"nextSibling":"previousSibling"];return sibling&&sibling.isSameNode(tree[direction?"rightBranch":"leftBranch"].topNode)?null:sibling},setUp=function(node,direction){if(node.nodeName.toLowerCase()===tagName){tree[direction?"leftBranch":"rightBranch"].startNode=node}if(node.parentNode.isSameNode(tree.topNode)){tree[direction?"leftBranch":"rightBranch"].topNode=node}else{setUp(node.parentNode,direction)}},wrapSiblings=function(node,direction){if(node){wrapNode(node,tagName);wrapSiblings(getSibling(node,direction),direction,tagName)}},up=function(node,direction){if(!node.isSameNode(tree.topNode)){wrapSiblings(getSibling(node,direction),direction,tagName);up(node.parentNode,direction,tagName)}},mergeEqualSiblings=function(node){node.innerHTML=node.innerHTML.replace(new RegExp("<\\/"+tagName+">\\s*<"+tagName+">","igm"),"")};setUp(range.startContainer,true);setUp(range.endContainer,false);tree.leftBranch.startNode=tree.leftBranch.startNode?tree.leftBranch.startNode:wrapTextNode(range.startContainer,range.startOffset,range.startContainer.textContent.length,tagName,true);tree.rightBranch.startNode=tree.rightBranch.startNode?tree.rightBranch.startNode:wrapTextNode(range.endContainer,0,range.endOffset,tagName,false);up(tree.leftBranch.startNode,true);up(tree.rightBranch.startNode,false);mergeEqualSiblings(tree.topNode);cleanTree(tree.topNode,tagName)};var clearAllHighlightsFromNode=function(node){var innerHTML=node.innerHTML.replace(/<\/?mark[^>]*>/g,"");node.innerHTML=innerHTML};var unwrapSelection=function(range,tagName){var intermediateNodes=getOnlySelectedElements(),startNode=range.startContainer,endNode=range.endContainer,topNode=range.commonAncestorContainer,cleanTags=function(node,tagName){var nodeHTML,parentNode;if(node){if(node.nodeType===3){node=node.parentElement}nodeHTML=node.innerHTML.replace(/<\/?mark[^>]*>/g,"");if(node.nodeName.toLowerCase()===tagName){parentNode=node.parentNode;node.outerHTML=nodeHTML;node=parentNode}else{node.innerHTML=nodeHTML}}return node};if(range.startOffset>0){startNode=wrapTextNode(startNode,0,range.startOffset,"tareplace"+tagName+"tareplace",true)}if(range.endOffset<range.endContainer.textContent.length){endNode=wrapTextNode(range.endContainer,range.endOffset,range.endContainer.textContent.length,"tareplace"+tagName+"tareplace",false)}topNode=cleanTags(topNode,tagName);topNode.innerHTML=topNode.innerHTML.replace(new RegExp("tareplace"+tagName+"tareplace","g"),tagName)};var wrapSelectionWithTag=function(customTag,reverse){var range=getRange(),tagName=customTag.toLowerCase().replace(/[<>]/gi,""),commonNode,startNode,endNode;if(range){commonNode=range.commonAncestorContainer;startNode=range.startContainer;endNode=range.endContainer;if(reverse){unwrapSelection(range,tagName)}else{if(commonNode.isSameNode(startNode)&&commonNode.isSameNode(endNode)){range.surroundContents($document[0].createElement(tagName))}else{wrapUp(range,null,tagName,true)}}cleanSelection()}};var isLeafTagged=function(node,top,tagName){var tagFound,atTop;if(node&&node.nodeName){tagFound=node.nodeName.toLowerCase()===tagName;atTop=node.isSameNode(top);return atTop?false:tagFound?true:isLeafTagged(node.parentNode,top,tagName)}return false};var isBranchUnderTag=function(node,tagName){if(node.nodeName.toLowerCase()===tagName){return true}else if(node.childNodes.length<1){return false}else{for(var i=0;i<node.childNodes.length;i++){return isBranchUnderTag(node.childNodes[i],tagName)}}};var isSelectionUnderTag=function(tagName,editorTopNode){var range=getRange(),nodes,areintermediateNodesUnderTag=function(){var nodes=range?getOnlySelectedElements():null,i=1;if(nodes.length<3){return true}else{while(nodes&&nodes.length>2&&i<nodes.length-1&&isBranchUnderTag(nodes[i],tagName)){i++}return i===nodes.length-1}};return range&&editorTopNode?isLeafTagged(range.commonAncestorContainer,editorTopNode,tagName)?true:isLeafTagged(range.startContainer,range.commonAncestorContainer,tagName)&&isLeafTagged(range.endContainer,range.commonAncestorContainer,tagName)&&areintermediateNodesUnderTag():false};return{getOnlySelectedElements:getOnlySelectedElements,getSelectionElement:function(){var range,sel,container;if(_document.selection&&_document.selection.createRange){range=_document.selection.createRange();return range.parentElement()}else if($window.getSelection){sel=$window.getSelection();if(sel.getRangeAt){if(sel.rangeCount>0){range=sel.getRangeAt(0)}}else{range=_document.createRange();range.setStart(sel.anchorNode,sel.anchorOffset);range.setEnd(sel.focusNode,sel.focusOffset);if(range.collapsed!==sel.isCollapsed){range.setStart(sel.focusNode,sel.focusOffset);range.setEnd(sel.anchorNode,sel.anchorOffset)}}if(range){container=range.commonAncestorContainer;return container.nodeType===3?container.parentNode:container}}},wrapSelectionWithTag:wrapSelectionWithTag,isSelectionUnderTag:isSelectionUnderTag,clearAllHighlightsFromNode:clearAllHighlightsFromNode,setSelectionToElementStart:function(el){if(_document.createRange&&$window.getSelection){var range=_document.createRange();range.selectNodeContents(el);range.setStart(el,0);range.setEnd(el,0);var sel=$window.getSelection();sel.removeAllRanges();sel.addRange(range)}else if(_document.selection&&_document.body.createTextRange){var textRange=_document.body.createTextRange();textRange.moveToElementText(el);textRange.collapse(true);textRange.moveEnd("character",0);textRange.moveStart("character",0);textRange.select()}},setSelectionToElementEnd:function(el){if(_document.createRange&&$window.getSelection){var range=_document.createRange();range.selectNodeContents(el);range.collapse(false);var sel=$window.getSelection();sel.removeAllRanges();sel.addRange(range)}else if(_document.selection&&_document.body.createTextRange){var textRange=_document.body.createTextRange();textRange.moveToElementText(el);textRange.collapse(false);textRange.select()}}}}])})();